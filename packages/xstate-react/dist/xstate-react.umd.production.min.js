!(function (t, e) {
  'object' == typeof exports && 'undefined' != typeof module
    ? e(exports, require('react'), require('xstate'))
    : 'function' == typeof define && define.amd
    ? define(['exports', 'react', 'xstate'], e)
    : e(((t = t || self)['xstate-react'] = {}), t.React, t.xstate);
})(this, function (t, e, n) {
  'use strict';
  function r() {
    return (r =
      Object.assign ||
      function (t) {
        for (var e = 1; e < arguments.length; e++) {
          var n = arguments[e];
          for (var r in n)
            Object.prototype.hasOwnProperty.call(n, r) && (t[r] = n[r]);
        }
        return t;
      }).apply(this, arguments);
  }
  function u(t, e) {
    (null == e || e > t.length) && (e = t.length);
    for (var n = 0, r = new Array(e); n < e; n++) r[n] = t[n];
    return r;
  }
  var i,
    c = e.useLayoutEffect;
  function o(t) {
    var n = e.useRef();
    return n.current || (n.current = { v: t() }), n.current.v;
  }
  function a(t, e) {
    var n = function () {
      for (var e = arguments.length, n = new Array(e), r = 0; r < e; r++)
        n[r] = arguments[r];
      return function () {
        return t.apply(void 0, n);
      };
    };
    return (
      Object.defineProperties(n, {
        name: { value: 'effect:' + t.name },
        __effect: { value: e }
      }),
      n
    );
  }
  function f(t, e) {
    (0, t.exec)(e.context, e._event.data, {
      action: t,
      state: e,
      _event: e._event
    })();
  }
  function s(t, n) {
    void 0 === n &&
      (n = function (t) {
        return 'state' in t ? t.state : void 0;
      });
    var r = e.useRef(t),
      u = e.useRef([]),
      i = e.useState(function () {
        return n(t);
      }),
      a = i[0],
      f = i[1],
      s = o(function () {
        return function (t) {
          var e = r.current;
          'deferred' in e && e.deferred ? u.current.push(t) : e.send(t);
        };
      });
    return (
      c(
        function () {
          (r.current = t), f(n(t));
          for (var e = t.subscribe(f); u.current.length > 0; ) {
            var i = u.current.shift();
            t.send(i);
          }
          return function () {
            e.unsubscribe();
          };
        },
        [t]
      ),
      [a, s]
    );
  }
  !(function (t) {
    (t[(t.Effect = 1)] = 'Effect'), (t[(t.LayoutEffect = 2)] = 'LayoutEffect');
  })(i || (i = {})),
    (t.asEffect = function (t) {
      return a(t, i.Effect);
    }),
    (t.asLayoutEffect = function (t) {
      return a(t, i.LayoutEffect);
    }),
    (t.useActor = s),
    (t.useMachine = function (t, a) {
      void 0 === a && (a = {});
      var s = o(function () {
          return 'function' == typeof t ? t() : t;
        }),
        v = a.context,
        d = a.guards,
        l = a.actions,
        p = a.activities,
        y = a.services,
        h = a.delays,
        b = a.state,
        g = (function (t, e) {
          if (null == t) return {};
          var n,
            r,
            u = {},
            i = Object.keys(t);
          for (r = 0; r < i.length; r++)
            e.indexOf((n = i[r])) >= 0 || (u[n] = t[n]);
          return u;
        })(a, [
          'context',
          'guards',
          'actions',
          'activities',
          'services',
          'delays',
          'state'
        ]),
        m = o(function () {
          var t = s.withConfig(
            {
              context: v,
              guards: d,
              actions: l,
              activities: p,
              services: y,
              delays: h
            },
            r({}, s.context, v)
          );
          return [t, n.interpret(t, r({ deferEvents: !0 }, g))];
        }),
        x = m[0],
        E = m[1],
        S = e.useState(function () {
          var t = x.initialState;
          return b ? n.State.create(b) : t;
        }),
        j = S[0],
        O = S[1],
        _ = e.useRef([]),
        A = e.useRef([]);
      return (
        c(function () {
          return (
            E.onTransition(function (t) {
              var e = void 0 === t.changed && Object.keys(t.children).length;
              if (((t.changed || e) && O(t), t.actions.length)) {
                var n,
                  r,
                  c = (function (t, e) {
                    for (
                      var n,
                        r = [],
                        c = [],
                        o = (function (t, e) {
                          var n;
                          if (
                            'undefined' == typeof Symbol ||
                            null == t[Symbol.iterator]
                          ) {
                            if (
                              Array.isArray(t) ||
                              (n = (function (t, e) {
                                if (t) {
                                  if ('string' == typeof t) return u(t, void 0);
                                  var n = Object.prototype.toString
                                    .call(t)
                                    .slice(8, -1);
                                  return (
                                    'Object' === n &&
                                      t.constructor &&
                                      (n = t.constructor.name),
                                    'Map' === n || 'Set' === n
                                      ? Array.from(t)
                                      : 'Arguments' === n ||
                                        /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(
                                          n
                                        )
                                      ? u(t, void 0)
                                      : void 0
                                  );
                                }
                              })(t))
                            ) {
                              n && (t = n);
                              var r = 0;
                              return function () {
                                return r >= t.length
                                  ? { done: !0 }
                                  : { done: !1, value: t[r++] };
                              };
                            }
                            throw new TypeError(
                              'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
                            );
                          }
                          return (n = t[Symbol.iterator]()).next.bind(n);
                        })(t);
                      !(n = o()).done;

                    ) {
                      var a = n.value;
                      a.exec.__effect === i.Effect ? r.push(a) : c.push(a);
                    }
                    return [r, c];
                  })(
                    t.actions.filter(function (t) {
                      return (
                        'function' == typeof t.exec && '__effect' in t.exec
                      );
                    })
                  ),
                  o = c[1];
                (n = _.current).push.apply(
                  n,
                  c[0].map(function (e) {
                    return [e, t];
                  })
                ),
                  (r = A.current).push.apply(
                    r,
                    o.map(function (e) {
                      return [e, t];
                    })
                  );
              }
            }).start(b ? n.State.create(b) : void 0),
            function () {
              E.stop();
            }
          );
        }, []),
        e.useEffect(
          function () {
            Object.assign(E.machine.options.actions, l);
          },
          [l]
        ),
        e.useEffect(
          function () {
            Object.assign(E.machine.options.services, y);
          },
          [y]
        ),
        c(
          function () {
            for (; A.current.length; ) {
              var t = A.current.shift();
              f(t[0], t[1]);
            }
          },
          [j]
        ),
        e.useEffect(
          function () {
            for (; _.current.length; ) {
              var t = _.current.shift();
              f(t[0], t[1]);
            }
          },
          [j]
        ),
        [j, E.send, E]
      );
    }),
    (t.useService = function (t) {
      return [
        s(
          e.useMemo(
            function () {
              return (function (t) {
                var e = t.machine;
                return {
                  send: t.send.bind(t),
                  subscribe: function (e) {
                    return t.subscribe(function (t) {
                      return e(t);
                    });
                  },
                  stop: t.stop,
                  current:
                    0 !== ('status' in t ? t.status : t._status)
                      ? t.state
                      : e.initialState,
                  name: t.sessionId
                };
              })(t);
            },
            [t]
          ),
          function (t) {
            return t.current;
          }
        )[0],
        t.send
      ];
    });
});
//# sourceMappingURL=xstate-react.umd.production.min.js.map
